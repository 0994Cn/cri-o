---

- name: clone runc source repo
  git:
    repo: "https://github.com/opencontainers/runc.git"
    dest: "{{ ansible_env.GOPATH }}/src/github.com/opencontainers/runc"
    version: "2b9a36ee8c82b580f09ed853dc72388aadca9ea9" # v1.0.0-rc10-307-g2b9a36ee

- name: build runc
  make:
    params: BUILDTAGS="seccomp selinux"
    chdir: "{{ ansible_env.GOPATH }}/src/github.com/opencontainers/runc"

- name: install runc
  make:
    target: "install"
    chdir: "{{ ansible_env.GOPATH }}/src/github.com/opencontainers/runc"

- name: link runc
  file:
    src: /usr/local/sbin/runc
    dest: /usr/bin/runc
    state: link
    force: yes
